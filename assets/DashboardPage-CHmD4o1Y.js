import{u as me,a as be,b as E,T as Je}from"./format-DdzCqv1e.js";import{c as Z,a as o,h as m,d as ge,g as Q,r as S,j as Ye,C as Ze,D as et,E as J,F as tt,w as at,G as rt,i as de,e as I,l as nt,f as st,v as ot,o as lt,_ as it,y as ut,z as ct,A as ve,H as he,B as V,Q as fe}from"./index-CFBji5LO.js";import{_ as _e,a as M,E as y,b as dt,c as G,d as xe,s as vt,e as ht,f as Y,g as ft,h as pt,i as mt}from"./index-Cp-3e1w5.js";const bt=Z({name:"QCard",props:{...me,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(r,{slots:n}){const{proxy:{$q:s}}=Q(),a=be(r,s),e=o(()=>"q-card"+(a.value===!0?" q-card--dark q-dark":"")+(r.bordered===!0?" q-card--bordered":"")+(r.square===!0?" q-card--square no-border-radius":"")+(r.flat===!0?" q-card--flat no-shadow":""));return()=>m(r.tag,{class:e.value},ge(n.default))}}),gt={name:String};function _t(r){return o(()=>({type:"hidden",name:r.name,value:r.modelValue}))}function xt(r={}){return(n,s,a)=>{n[s](m("input",{class:"hidden"+(a||""),...r.value}))}}const pe="q-slider__marker-labels",kt=r=>({value:r}),yt=({marker:r})=>m("div",{key:r.value,style:r.style,class:r.classes},r.label),ke=[34,37,40,33,39,38],Ct={...me,...gt,min:{type:Number,default:0},max:{type:Number,default:100},innerMin:Number,innerMax:Number,step:{type:Number,default:1,validator:r=>r>=0},snap:Boolean,vertical:Boolean,reverse:Boolean,color:String,markerLabelsClass:String,label:Boolean,labelColor:String,labelTextColor:String,labelAlways:Boolean,switchLabelSide:Boolean,markers:[Boolean,Number],markerLabels:[Boolean,Array,Object,Function],switchMarkerLabelsSide:Boolean,trackImg:String,trackColor:String,innerTrackImg:String,innerTrackColor:String,selectionColor:String,selectionImg:String,thumbSize:{type:String,default:"20px"},trackSize:{type:String,default:"4px"},disable:Boolean,readonly:Boolean,dense:Boolean,tabindex:[String,Number],thumbColor:String,thumbPath:{type:String,default:"M 4, 10 a 6,6 0 1,0 12,0 a 6,6 0 1,0 -12,0"}},wt=["pan","update:modelValue","change"];function St({updateValue:r,updatePosition:n,getDragging:s,formAttrs:a}){const{props:e,emit:l,slots:u,proxy:{$q:c}}=Q(),B=be(e,c),T=xt(a),k=S(!1),h=S(!1),f=S(!1),_=S(!1),g=o(()=>e.vertical===!0?"--v":"--h"),j=o(()=>"-"+(e.switchLabelSide===!0?"switched":"standard")),$=o(()=>e.vertical===!0?e.reverse===!0:e.reverse!==(c.lang.rtl===!0)),C=o(()=>isNaN(e.innerMin)===!0||e.innerMin<e.min?e.min:e.innerMin),q=o(()=>isNaN(e.innerMax)===!0||e.innerMax>e.max?e.max:e.innerMax),p=o(()=>e.disable!==!0&&e.readonly!==!0&&C.value<q.value),F=o(()=>{if(e.step===0)return i=>i;const t=(String(e.step).trim().split(".")[1]||"").length;return i=>parseFloat(i.toFixed(t))}),L=o(()=>e.step===0?1:e.step),Ce=o(()=>p.value===!0?e.tabindex||0:-1),R=o(()=>e.max-e.min),ee=o(()=>q.value-C.value),P=o(()=>K(C.value)),H=o(()=>K(q.value)),z=o(()=>e.vertical===!0?$.value===!0?"bottom":"top":$.value===!0?"right":"left"),te=o(()=>e.vertical===!0?"height":"width"),we=o(()=>e.vertical===!0?"width":"height"),ae=o(()=>e.vertical===!0?"vertical":"horizontal"),Se=o(()=>{const t={role:"slider","aria-valuemin":C.value,"aria-valuemax":q.value,"aria-orientation":ae.value,"data-step":e.step};return e.disable===!0?t["aria-disabled"]="true":e.readonly===!0&&(t["aria-readonly"]="true"),t}),Me=o(()=>`q-slider q-slider${g.value} q-slider--${k.value===!0?"":"in"}active inline no-wrap `+(e.vertical===!0?"row":"column")+(e.disable===!0?" disabled":" q-slider--enabled"+(p.value===!0?" q-slider--editable":""))+(f.value==="both"?" q-slider--focus":"")+(e.label||e.labelAlways===!0?" q-slider--label":"")+(e.labelAlways===!0?" q-slider--label-always":"")+(B.value===!0?" q-slider--dark":"")+(e.dense===!0?" q-slider--dense q-slider--dense"+g.value:""));function D(t){const i="q-slider__"+t;return`${i} ${i}${g.value} ${i}${g.value}${j.value}`}function re(t){const i="q-slider__"+t;return`${i} ${i}${g.value}`}const Be=o(()=>{const t=e.selectionColor||e.color;return"q-slider__selection absolute"+(t!==void 0?` text-${t}`:"")}),$e=o(()=>re("markers")+" absolute overflow-hidden"),qe=o(()=>re("track-container")),Fe=o(()=>D("pin")),Ae=o(()=>D("label")),Le=o(()=>D("text-container")),Ie=o(()=>D("marker-labels-container")+(e.markerLabelsClass!==void 0?` ${e.markerLabelsClass}`:"")),Ee=o(()=>"q-slider__track relative-position no-outline"+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),Te=o(()=>{const t={[we.value]:e.trackSize};return e.trackImg!==void 0&&(t.backgroundImage=`url(${e.trackImg}) !important`),t}),Re=o(()=>"q-slider__inner absolute"+(e.innerTrackColor!==void 0?` bg-${e.innerTrackColor}`:"")),ne=o(()=>{const t=H.value-P.value,i={[z.value]:`${100*P.value}%`,[te.value]:t===0?"2px":`${100*t}%`};return e.innerTrackImg!==void 0&&(i.backgroundImage=`url(${e.innerTrackImg}) !important`),i});function Pe(t){const{min:i,max:d,step:v}=e;let b=i+t*(d-i);if(v>0){const A=(b-C.value)%v;b+=(Math.abs(A)>=v/2?(A<0?-1:1)*v:0)-A}return b=F.value(b),E(b,C.value,q.value)}function K(t){return R.value===0?0:(t-e.min)/R.value}function ze(t,i){const d=Ze(t),v=e.vertical===!0?E((d.top-i.top)/i.height,0,1):E((d.left-i.left)/i.width,0,1);return E($.value===!0?1-v:v,P.value,H.value)}const se=o(()=>et(e.markers)===!0?e.markers:L.value),oe=o(()=>{const t=[],i=se.value,d=e.max;let v=e.min;do t.push(v),v+=i;while(v<d);return t.push(d),t}),le=o(()=>{const t=` ${pe}${g.value}-`;return pe+`${t}${e.switchMarkerLabelsSide===!0?"switched":"standard"}${t}${$.value===!0?"rtl":"ltr"}`}),O=o(()=>e.markerLabels===!1?null:Ve(e.markerLabels).map((t,i)=>({index:i,value:t.value,label:t.label||t.value,classes:le.value+(t.classes!==void 0?" "+t.classes:""),style:{...ue(t.value),...t.style||{}}}))),ie=o(()=>({markerList:O.value,markerMap:Ne.value,classes:le.value,getStyle:ue})),De=o(()=>{const t=ee.value===0?"2px":100*se.value/ee.value;return{...ne.value,backgroundSize:e.vertical===!0?`2px ${t}%`:`${t}% 2px`}});function Ve(t){if(t===!1)return null;if(t===!0)return oe.value.map(kt);if(typeof t=="function")return oe.value.map(d=>{const v=t(d);return J(v)===!0?{...v,value:d}:{value:d,label:v}});const i=({value:d})=>d>=e.min&&d<=e.max;return Array.isArray(t)===!0?t.map(d=>J(d)===!0?d:{value:d}).filter(i):Object.keys(t).map(d=>{const v=t[d],b=Number(d);return J(v)===!0?{...v,value:b}:{value:b,label:v}}).filter(i)}function ue(t){return{[z.value]:`${100*(t-e.min)/R.value}%`}}const Ne=o(()=>{if(e.markerLabels===!1)return null;const t={};return O.value.forEach(i=>{t[i.value]=i}),t});function Ge(){if(u["marker-label-group"]!==void 0)return u["marker-label-group"](ie.value);const t=u["marker-label"]||yt;return O.value.map(i=>t({marker:i,...ie.value}))}const Qe=o(()=>[[Je,je,void 0,{[ae.value]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function je(t){t.isFinal===!0?(_.value!==void 0&&(n(t.evt),t.touch===!0&&r(!0),_.value=void 0,l("pan","end")),k.value=!1,f.value=!1):t.isFirst===!0?(_.value=s(t.evt),n(t.evt),r(),k.value=!0,l("pan","start")):(n(t.evt),r())}function ce(){f.value=!1}function He(t){n(t,s(t)),r(),h.value=!0,k.value=!0,document.addEventListener("mouseup",U,!0)}function U(){h.value=!1,k.value=!1,r(!0),ce(),document.removeEventListener("mouseup",U,!0)}function Ke(t){n(t,s(t)),r(!0)}function Oe(t){ke.includes(t.keyCode)&&r(!0)}function Ue(t){if(e.vertical===!0)return null;const i=c.lang.rtl!==e.reverse?1-t:t;return{transform:`translateX(calc(${2*i-1} * ${e.thumbSize} / 2 + ${50-100*i}%))`}}function We(t){const i=o(()=>h.value===!1&&(f.value===t.focusValue||f.value==="both")?" q-slider--focus":""),d=o(()=>`q-slider__thumb q-slider__thumb${g.value} q-slider__thumb${g.value}-${$.value===!0?"rtl":"ltr"} absolute non-selectable`+i.value+(t.thumbColor.value!==void 0?` text-${t.thumbColor.value}`:"")),v=o(()=>({width:e.thumbSize,height:e.thumbSize,[z.value]:`${100*t.ratio.value}%`,zIndex:f.value===t.focusValue?2:void 0})),b=o(()=>t.labelColor.value!==void 0?` text-${t.labelColor.value}`:""),A=o(()=>Ue(t.ratio.value)),W=o(()=>"q-slider__text"+(t.labelTextColor.value!==void 0?` text-${t.labelTextColor.value}`:""));return()=>{const X=[m("svg",{class:"q-slider__thumb-shape absolute-full",viewBox:"0 0 20 20","aria-hidden":"true"},[m("path",{d:e.thumbPath})]),m("div",{class:"q-slider__focus-ring fit"})];return(e.label===!0||e.labelAlways===!0)&&(X.push(m("div",{class:Fe.value+" absolute fit no-pointer-events"+b.value},[m("div",{class:Ae.value,style:{minWidth:e.thumbSize}},[m("div",{class:Le.value,style:A.value},[m("span",{class:W.value},t.label.value)])])])),e.name!==void 0&&e.disable!==!0&&T(X,"push")),m("div",{class:d.value,style:v.value,...t.getNodeData()},X)}}function Xe(t,i,d,v){const b=[];e.innerTrackColor!=="transparent"&&b.push(m("div",{key:"inner",class:Re.value,style:ne.value})),e.selectionColor!=="transparent"&&b.push(m("div",{key:"selection",class:Be.value,style:t.value})),e.markers!==!1&&b.push(m("div",{key:"marker",class:$e.value,style:De.value})),v(b);const A=[tt("div",{key:"trackC",class:qe.value,tabindex:i.value,...d.value},[m("div",{class:Ee.value,style:Te.value},b)],"slide",p.value,()=>Qe.value)];if(e.markerLabels!==!1){const W=e.switchMarkerLabelsSide===!0?"unshift":"push";A[W](m("div",{key:"markerL",class:Ie.value},Ge()))}return A}return Ye(()=>{document.removeEventListener("mouseup",U,!0)}),{state:{active:k,focus:f,preventFocus:h,dragging:_,editable:p,classes:Me,tabindex:Ce,attributes:Se,roundValueFn:F,keyStep:L,trackLen:R,innerMin:C,innerMinRatio:P,innerMax:q,innerMaxRatio:H,positionProp:z,sizeProp:te,isReversed:$},methods:{onActivate:He,onMobileClick:Ke,onBlur:ce,onKeyup:Oe,getContent:Xe,getThumbRenderFn:We,convertRatioToModel:Pe,convertModelToRatio:K,getDraggingRatio:ze}}}const Mt=()=>({}),Bt=Z({name:"QSlider",props:{...Ct,modelValue:{required:!0,default:null,validator:r=>typeof r=="number"||r===null},labelValue:[String,Number]},emits:wt,setup(r,{emit:n}){const{proxy:{$q:s}}=Q(),{state:a,methods:e}=St({updateValue:g,updatePosition:$,getDragging:j,formAttrs:_t(r)}),l=S(null),u=S(0),c=S(0);function B(){c.value=r.modelValue===null?a.innerMin.value:E(r.modelValue,a.innerMin.value,a.innerMax.value)}at(()=>`${r.modelValue}|${a.innerMin.value}|${a.innerMax.value}`,B),B();const T=o(()=>e.convertModelToRatio(c.value)),k=o(()=>a.active.value===!0?u.value:T.value),h=o(()=>{const p={[a.positionProp.value]:`${100*a.innerMinRatio.value}%`,[a.sizeProp.value]:`${100*(k.value-a.innerMinRatio.value)}%`};return r.selectionImg!==void 0&&(p.backgroundImage=`url(${r.selectionImg}) !important`),p}),f=e.getThumbRenderFn({focusValue:!0,getNodeData:Mt,ratio:k,label:o(()=>r.labelValue!==void 0?r.labelValue:c.value),thumbColor:o(()=>r.thumbColor||r.color),labelColor:o(()=>r.labelColor),labelTextColor:o(()=>r.labelTextColor)}),_=o(()=>a.editable.value!==!0?{}:s.platform.is.mobile===!0?{onClick:e.onMobileClick}:{onMousedown:e.onActivate,onFocus:C,onBlur:e.onBlur,onKeydown:q,onKeyup:e.onKeyup});function g(p){c.value!==r.modelValue&&n("update:modelValue",c.value),p===!0&&n("change",c.value)}function j(){return l.value.getBoundingClientRect()}function $(p,F=a.dragging.value){const L=e.getDraggingRatio(p,F);c.value=e.convertRatioToModel(L),u.value=r.snap!==!0||r.step===0?L:e.convertModelToRatio(c.value)}function C(){a.focus.value=!0}function q(p){if(!ke.includes(p.keyCode))return;rt(p);const F=([34,33].includes(p.keyCode)?10:1)*a.keyStep.value,L=([34,37,40].includes(p.keyCode)?-1:1)*(a.isReversed.value===!0?-1:1)*(r.vertical===!0?-1:1)*F;c.value=E(a.roundValueFn.value(c.value+L),a.innerMin.value,a.innerMax.value),g()}return()=>{const p=e.getContent(h,a.tabindex,_,F=>{F.push(f())});return m("div",{ref:l,class:a.classes.value+(r.modelValue===null?" q-slider--no-value":""),...a.attributes.value,"aria-valuenow":r.modelValue},p)}}}),$t=Z({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(r,{slots:n}){const{proxy:{$q:s}}=Q(),a=de(nt,I);if(a===I)return console.error("QPage needs to be a deep child of QLayout"),I;if(de(st,I)===I)return console.error("QPage needs to be child of QPageContainer"),I;const l=o(()=>{const c=(a.header.space===!0?a.header.size:0)+(a.footer.space===!0?a.footer.size:0);if(typeof r.styleFn=="function"){const B=a.isContainer.value===!0?a.containerHeight.value:s.screen.height;return r.styleFn(c,B)}return{minHeight:a.isContainer.value===!0?a.containerHeight.value-c+"px":s.screen.height===0?c!==0?`calc(100vh - ${c}px)`:"100vh":s.screen.height-c+"px"}}),u=o(()=>`q-page${r.padding===!0?" q-layout-padding":""}`);return()=>m("main",{class:u.value,style:l.value},ge(n.default))}});var x=(r=>(r.Abort="Abort",r.Break="Break",r.Continue="Continue",r.Skip="Skip",r))(x||{}),w=(r=>(r.AfterExtract="AfterExtract",r.AfterInsert="AfterInsert",r.BeforeExtract="BeforeExtract",r.BeforeInsert="BeforeInsert",r))(w||{});class qt extends Array{constructor(n,s){super(n);for(let a=0;a<n;a++)this[a]=new Array(s)}}class Ft extends _e{fieldSize;_field;_modifyHandlersMap=new Map([[w.AfterExtract,[]],[w.AfterInsert,[]],[w.BeforeExtract,[]],[w.BeforeInsert,[]]]);constructor(n){super({anchor:M(0,0),height:y*n.y,width:y*n.x}),this.fieldSize=n,this._field=new qt(n.x,n.y)}morphField(n,s){this.fieldSize=n,this._field=s(this,n)}addModifyHandler(n,s){const a=this._modifyHandlersMap.get(n);a&&!a.find(e=>e.id===s.id)&&(a.push(s),a.sort((e,l)=>e.priority===l.priority?e.id<l.id?-1:1:l.priority-e.priority))}extract(n){const s=[];let a=x.Continue,e=n.map(l=>({position:l,value:this._field[l.x][l.y]}));for(const l of this._modifyHandlersMap.get(w.BeforeExtract)??[]){if(a=l.handle(this,e),a===x.Abort)return s;if(a===x.Break)break}a!==x.Skip&&(e.forEach(({position:{x:l,y:u}})=>{s.push({position:{x:l,y:u},value:this._field[l][u]}),this._field[l][u]=void 0}),e=s);for(const l of this._modifyHandlersMap.get(w.AfterExtract)??[]){if(a=l.handle(this,e),a===x.Abort)return s;if(a===x.Break)break}return s}insert(n){let s=x.Continue;for(const a of this._modifyHandlersMap.get(w.BeforeInsert)??[]){if(s=a.handle(this,n),s===x.Abort)return;if(s===x.Break)break}s!==x.Skip&&n.forEach(({position:{x:a,y:e},value:l})=>{this._field[a][e]=l});for(const a of this._modifyHandlersMap.get(w.AfterInsert)??[]){if(s=a.handle(this,n),s===x.Abort)return;if(s===x.Break)break}}removeModifyHandler(n,s){const a=this._modifyHandlersMap.get(n);if(a){const e=a.findIndex(l=>l.id===s);e!==-1&&a.splice(e,1)}}get size(){const{bottom:n,left:s,right:a,top:e}=this.graphics.bounds;return{height:n-e,width:a-s}}update(n,s){this._updateGraphics(),super.update(n,s)}_updateGraphics(){const n=[{graphic:new dt({color:G.Transparent,strokeColor:G.LightGray,lineWidth:y*.15,height:this.height,width:this.width}),offset:M(0,0)}],s=new xe({members:n.concat(this._field.flatMap((a,e)=>a.flatMap((l,u)=>l?{graphic:l.sprite,offset:M(e*l.width,u*l.height)}:[])))});this.graphics.use(s)}}class ye{sprite;data;constructor(n,s,a){const e=vt.getSprite(n,s);if(!e)throw new Error("Failed to load sprite");this.sprite=e,this.data=a}get height(){return this.sprite.height}get width(){return this.sprite.width}}class N extends ye{position;constructor(n,s,a,e){super(n,s,a),this.position=e}get renderPosition(){return{x:this.position.x*this.width,y:this.position.y*this.height}}}class At extends _e{position;_boundingBox;_renderingFaces;constructor(n,s,a){const e=n.map(c=>c.position.x),l=n.map(c=>c.position.y),u=new ht(Math.min(...e),Math.min(...l),Math.max(...e),Math.max(...l));super({...a,anchor:M(0,0),height:(u.bottom-u.top+1)*y,width:(u.right-u.left+1)*y}),this.position=s,this._boundingBox=u,this._renderingFaces=n}update(n,s){n.input.keyboard.isHeld(Y.Keys.A)&&this.position.x>-this._boundingBox.left&&(this.position.x-=1),n.input.keyboard.isHeld(Y.Keys.D)&&this.position.x<9-this._boundingBox.right&&(this.position.x+=1),n.input.keyboard.isHeld(Y.Keys.S)&&this.position.y<19-this._boundingBox.bottom&&(this.position.y+=1),this._updateGraphics(),super.update(n,s)}_updateGraphics(){const n=y*this.scale.x*.1,s=new xe({members:this._renderingFaces.map(({renderPosition:a,sprite:e})=>({graphic:e,offset:M(a.x,a.y)})).concat([{graphic:new ft({radius:n,color:G.White}),offset:M(y*this.scale.x/2-n*1.5,y*this.scale.y/2-n*1.5)}])});this.graphics.use(s),this.pos=M(this.position.x*y*this.scale.x,this.position.y*y*this.scale.y)}}const Lt=ot({__name:"DashboardPage",setup(r,{expose:n}){n();const s=S(),a={x:10,y:20},e=S(100),l=new At([new N("crystal",0,void 0,{x:-1,y:0}),new N("crystal",0,void 0,{x:0,y:0}),new N("crystal",0,void 0,{x:0,y:-1}),new N("crystal",0,void 0,{x:1,y:-1})],{x:1,y:1}),u=new Ft(a),c=()=>{const h=[];for(let f=0;f<u.fieldSize.y;f++)for(let _=0;_<u.fieldSize.x;_++){const g=new Uint32Array(2);crypto.getRandomValues(g),!(Math.floor(g[0]%16)<8)&&h.push({value:new ye("crystal",Math.floor(g[1]%16),void 0),position:{x:_,y:f}})}u.insert(h)},B=()=>{const h=[];for(let f=0;f<u.fieldSize.y;f++)for(let _=0;_<u.fieldSize.x;_++)h.push({x:_,y:f});u.extract(h)},T=h=>{const f=h?M(h/100,h/100):M(1,1);l.scale=f,u.scale=f};lt(async()=>{const h=new pt({backgroundColor:G.Transparent,canvasElement:s.value,displayMode:mt.FillContainer,enableCanvasTransparency:!0,fixedUpdateFps:1e3});h.add(u),h.add(l),h.onFatalException(()=>{h.stop()}),await h.start()});const k={mainGame:s,fieldSize:a,scale:e,faceGroupActor:l,field:u,randomInsertField:c,clearField:B,setScales:T};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}}),It={class:"col-10 column q-gutter-y-md"},Et={ref:"mainGame",class:"rounded-borders"};function Tt(r,n,s,a,e,l){return ut(),ct($t,{class:"row items-center justify-evenly"},{default:ve(()=>[he("div",It,[V(bt,{style:{height:"80vh"}},{default:ve(()=>[he("canvas",Et,null,512)]),_:1}),V(Bt,{color:"green",min:25,step:5,max:100,modelValue:a.scale,"onUpdate:modelValue":[n[0]||(n[0]=u=>a.scale=u),a.setScales]},null,8,["modelValue"]),V(fe,{label:"insert",onClick:a.randomInsertField}),V(fe,{label:"clear",onClick:a.clearField})])]),_:1})}const Dt=it(Lt,[["render",Tt],["__file","DashboardPage.vue"]]);export{Dt as default};
